<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Website Template with Google Sheets CMS - Debug Version</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f0f0f0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Debug Panel */
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 400px;
            max-height: 80vh;
            background: #fff;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            z-index: 10000;
            font-family: monospace;
            font-size: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .debug-panel h3 {
            margin-bottom: 10px;
            font-size: 14px;
            color: #d32f2f;
        }

        .debug-section {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .debug-section h4 {
            margin-bottom: 5px;
            color: #1976d2;
            font-size: 12px;
        }

        .debug-content {
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .debug-error {
            background: #ffebee;
            color: #c62828;
        }

        .debug-success {
            background: #e8f5e8;
            color: #2e7d32;
        }

        /* Website Styles (will be overridden by Google Sheets) */
        .site-header {
            background-color: #2196F3;
            color: white;
            padding: 60px 0;
            text-align: center;
        }

        .site-title {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .site-hero {
            width: 100%;
            max-width: 600px;
            height: 300px;
            object-fit: cover;
            margin: 20px auto;
            border-radius: 10px;
        }

        .site-slogan {
            font-size: 1.5em;
            margin-bottom: 20px;
            font-style: italic;
        }

        .site-intro {
            font-size: 1.1em;
            max-width: 800px;
            margin: 0 auto;
        }

        .content-section {
            background-color: white;
            padding: 40px 0;
            margin: 20px 0;
            border-radius: 10px;
        }

        .section-header {
            font-size: 2em;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .section-content {
            display: flex;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .section-image {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            height: 250px;
            object-fit: cover;
            border-radius: 10px;
        }

        .section-text {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            font-size: 1.1em;
            line-height: 1.8;
        }

        .site-footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #d32f2f;
            background-color: #ffebee;
            margin: 20px;
            border-radius: 10px;
        }

        .section-link {
            display: block;
            text-align: center;
            margin-bottom: 20px;
        }

        .section-link a {
            display: inline-block;
            background-color: #2196F3;
            color: white;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .section-link a:hover {
            background-color: #1976D2;
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <h3>üîç Debug Panel</h3>
        <div id="debugContent">
            <div class="debug-section">
                <h4>Status:</h4>
                <div class="debug-content">Initializing...</div>
            </div>
        </div>
    </div>

    <!-- Loading Message -->
    <div id="loading" class="loading">
        Loading website content from Google Sheets...
    </div>

    <!-- Error Message (hidden by default) -->
    <div id="error" class="error" style="display: none;">
        Error loading content. Please check your Google Sheet URL and make sure it's publicly accessible.
    </div>

    <!-- Website Content (populated by JavaScript) -->
    <div id="website" style="display: none;">
        <!-- Site Header -->
        <header class="site-header">
            <div class="container">
                <h1 class="site-title" id="siteTitle">Website Title</h1>
                <img class="site-hero" id="siteHero" src="https://via.placeholder.com/600x300/2196F3/FFFFFF?text=Your+Hero+Image" alt="Hero Image">
                <p class="site-slogan" id="siteSlogan">Your Website Slogan</p>
                <p class="site-intro" id="siteIntro">Welcome to your website! This content is loaded from Google Sheets.</p>
            </div>
        </header>

        <!-- Content Sections (populated by JavaScript) -->
        <main id="contentSections">
            <!-- Sections will be added here dynamically -->
        </main>

        <!-- Site Footer -->
        <footer class="site-footer">
            <div class="container">
                <p id="siteFooter">¬© 2024 Your Website. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Include Papa Parse for better CSV handling -->
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    
    <script>
        // Debug logging function
        function debugLog(message, type = 'info') {
            const debugContent = document.getElementById('debugContent');
            const timestamp = new Date().toLocaleTimeString();
            const cssClass = type === 'error' ? 'debug-error' : type === 'success' ? 'debug-success' : '';
            
            const debugEntry = document.createElement('div');
            debugEntry.className = 'debug-section';
            debugEntry.innerHTML = `
                <h4>[${timestamp}] ${type.toUpperCase()}</h4>
                <div class="debug-content ${cssClass}">${message}</div>
            `;
            
            debugContent.appendChild(debugEntry);
            debugContent.scrollTop = debugContent.scrollHeight;
            
            // Also log to console
            console.log(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
        }

        // Configuration
        const SHEET_ID = '2PACX-1vQk5bXrLZDv8kRuSAMn4yQFwzux46d60T_AFhfU4-ZMNyB8X-TiHapOLh0uyd-TuAURW8JiEotzT5Fn';
        const CONTENT_GID = '0';  // Content sheet
        const STYLING_GID = '2066685483';  // Styling sheet

        // Fetch CSV data
        async function fetchCSVData(gid) {
            try {
                // Use the published URL format
                const publishedUrl = `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pub?output=csv&gid=${gid}`;
                debugLog(`Fetching from published CSV URL: ${publishedUrl}`, 'info');
                
                const response = await fetch(publishedUrl);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}. Please ensure your sheet is published to the web with CSV format enabled.`);
                }
                
                const csvText = await response.text();
                debugLog(`Published CSV URL worked!`, 'success');
                debugLog(`Raw CSV data (first 200 chars): ${csvText.substring(0, 200)}...`, 'info');
                debugLog(`Total CSV length: ${csvText.length} characters`, 'info');
                
                return csvText;
            } catch (error) {
                debugLog(`Error fetching CSV: ${error.message}`, 'error');
                throw error;
            }
        }

        // Parse CSV using Papa Parse
        function parseCSV(csvText) {
            try {
                debugLog('Starting CSV parsing with Papa Parse...', 'info');
                
                const results = Papa.parse(csvText, {
                    skipEmptyLines: false,  // Don't skip empty lines - we need to see structure
                    delimiter: ',',        // Force comma delimiter
                    quoteChar: '"',
                    escapeChar: '"'
                });
                
                debugLog(`Parse completed. Data rows: ${results.data.length}`, 'info');
                debugLog(`Parse errors: ${results.errors.length}`, results.errors.length > 0 ? 'error' : 'success');
                
                if (results.errors.length > 0) {
                    results.errors.forEach(error => {
                        debugLog(`Parse error: ${error.message} (row ${error.row})`, 'error');
                    });
                }
                
                // Log each row for debugging
                results.data.forEach((row, index) => {
                    debugLog(`Row ${index}: [${row.map(cell => `"${cell}"`).join(', ')}]`, 'info');
                });
                
                return results.data;
            } catch (error) {
                debugLog(`Error parsing CSV: ${error.message}`, 'error');
                throw error;
            }
        }

        // Extract data from parsed content
        function extractContentData(data) {
            try {
                debugLog('Extracting content data...', 'info');
                
                // Find header row and content start
                let headerRowIndex = -1;
                let contentStartIndex = -1;
                
                // Look for the site header row (contains actual data)
                for (let i = 0; i < data.length; i++) {
                    const row = data[i];
                    if (row.length > 0 && row[0] && row[0].includes('Site Title')) {
                        headerRowIndex = i + 1;  // Actual data is in the next row
                        break;
                    }
                }
                
                // Look for sections header row
                for (let i = 0; i < data.length; i++) {
                    const row = data[i];
                    if (row.length > 0 && row[0] && row[0].includes('Section Header')) {
                        contentStartIndex = i + 1;  // Actual content starts after this row
                        break;
                    }
                }
                
                debugLog(`Header row index: ${headerRowIndex}`, 'info');
                debugLog(`Content start index: ${contentStartIndex}`, 'info');
                
                if (headerRowIndex === -1) {
                    throw new Error('Could not find site header data row');
                }
                
                if (contentStartIndex === -1) {
                    throw new Error('Could not find sections data start row');
                }
                
                // Extract site header data
                const headerRow = data[headerRowIndex];
                debugLog(`Header row found: [${headerRow.map(cell => `"${cell}"`).join(', ')}]`, 'info');
                
                const siteData = {
                    title: headerRow[1] || '',
                    heroImage: headerRow[2] || '',
                    slogan: headerRow[3] || '',
                    intro: headerRow[4] || '',
                    footer: headerRow[5] || ''
                };
                
                debugLog(`Site data extracted: ${JSON.stringify(siteData)}`, 'success');
                
                // Extract content sections
                const sections = [];
                for (let i = contentStartIndex; i < data.length; i++) {
                    const row = data[i];
                    debugLog(`Processing section row ${i}: [${row.map(cell => `"${cell}"`).join(', ')}]`, 'info');
                    
                    // Skip completely empty rows
                    if (row.every(cell => !cell || cell.trim() === '')) {
                        debugLog(`Skipping empty row ${i}`, 'info');
                        continue;
                    }
                    
                    // Make sure we have at least the header column
                    if (row.length > 0 && row[0] && row[0].trim() !== '') {
                        const section = {
                            header: row[0] || '',
                            link: row[1] || '',
                            image: row[2] || '',
                            text: row[3] || ''
                        };
                        
                        debugLog(`Section extracted: ${JSON.stringify(section)}`, 'success');
                        sections.push(section);
                    } else {
                        debugLog(`Skipping invalid section row ${i}`, 'info');
                    }
                }
                
                debugLog(`Total sections found: ${sections.length}`, 'success');
                
                return { siteData, sections };
            } catch (error) {
                debugLog(`Error extracting content: ${error.message}`, 'error');
                throw error;
            }
        }

        // Extract styling data
        function extractStylingData(data) {
            try {
                debugLog('Extracting styling data...', 'info');
                
                const styles = {
                    headerBg: '#2196F3',
                    headerText: '#FFFFFF',
                    sectionBg: '#FFFFFF',
                    sectionText: '#333333',
                    footerBg: '#333333',
                    footerText: '#FFFFFF'
                };
                
                // Find styling data row (skip header row)
                for (let i = 1; i < data.length; i++) {
                    const row = data[i];
                    if (row.length >= 6 && row[0] && row[0].trim() !== '') {
                        styles.headerBg = row[0] || styles.headerBg;
                        styles.headerText = row[1] || styles.headerText;
                        styles.sectionBg = row[2] || styles.sectionBg;
                        styles.sectionText = row[3] || styles.sectionText;
                        styles.footerBg = row[4] || styles.footerBg;
                        styles.footerText = row[5] || styles.footerText;
                        break;
                    }
                }
                
                debugLog(`Styling data extracted: ${JSON.stringify(styles)}`, 'success');
                return styles;
            } catch (error) {
                debugLog(`Error extracting styling: ${error.message}`, 'error');
                // Return default styles on error
                return {
                    headerBg: '#2196F3',
                    headerText: '#FFFFFF',
                    sectionBg: '#FFFFFF',
                    sectionText: '#333333',
                    footerBg: '#333333',
                    footerText: '#FFFFFF'
                };
            }
        }

        // Apply styling to the website
        function applyStyling(styles) {
            try {
                debugLog('Applying styling...', 'info');
                
                document.body.style.backgroundColor = styles.sectionBg;
                
                document.querySelector('.site-header').style.backgroundColor = styles.headerBg;
                document.querySelector('.site-header').style.color = styles.headerText;
                
                const sections = document.querySelectorAll('.content-section');
                sections.forEach(section => {
                    section.style.backgroundColor = styles.sectionBg;
                    section.style.color = styles.sectionText;
                });
                
                document.querySelector('.site-footer').style.backgroundColor = styles.footerBg;
                document.querySelector('.site-footer').style.color = styles.footerText;
                
                debugLog('Styling applied successfully', 'success');
            } catch (error) {
                debugLog(`Error applying styling: ${error.message}`, 'error');
            }
        }

        // Populate website content
        function populateWebsite(siteData, sections) {
            try {
                debugLog('Populating website content...', 'info');
                
                // Update site header
                document.getElementById('siteTitle').textContent = siteData.title || 'Website Title';
                
                const heroImg = document.getElementById('siteHero');
                if (siteData.heroImage) {
                    heroImg.src = siteData.heroImage;
                    heroImg.style.display = 'block';
                }
                
                document.getElementById('siteSlogan').textContent = siteData.slogan || 'Your Website Slogan';
                document.getElementById('siteIntro').textContent = siteData.intro || 'Welcome to your website!';
                document.getElementById('siteFooter').textContent = siteData.footer || '¬© 2024 Your Website. All rights reserved.';
                
                // Clear existing sections
                const contentSections = document.getElementById('contentSections');
                contentSections.innerHTML = '';
                
                // Add content sections
                sections.forEach((section, index) => {
                    debugLog(`Creating section ${index + 1}: ${section.header}`, 'info');
                    
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'content-section';
                    
                    let sectionHTML = '<div class="container">';
                    
                    // Add link if provided
                    if (section.link && section.link.trim() !== '') {
                        sectionHTML += `
                            <div class="section-link">
                                <a href="${section.link}" target="_blank">Learn More</a>
                            </div>
                        `;
                    }
                    
                    sectionHTML += `
                        <h2 class="section-header">${section.header || 'Section Title'}</h2>
                        <div class="section-content">
                    `;
                    
                    // Add image if provided
                    if (section.image && section.image.trim() !== '') {
                        sectionHTML += `
                            <img class="section-image" src="${section.image}" alt="${section.header}">
                        `;
                    }
                    
                    // Add text if provided
                    if (section.text && section.text.trim() !== '') {
                        sectionHTML += `
                            <div class="section-text">${section.text}</div>
                        `;
                    }
                    
                    sectionHTML += `
                        </div>
                        </div>
                    `;
                    
                    sectionDiv.innerHTML = sectionHTML;
                    contentSections.appendChild(sectionDiv);
                    
                    debugLog(`Section ${index + 1} added successfully`, 'success');
                });
                
                debugLog('Website populated successfully', 'success');
            } catch (error) {
                debugLog(`Error populating website: ${error.message}`, 'error');
                throw error;
            }
        }

        // Main function to load and display website
        async function loadWebsite() {
            try {
                debugLog('Starting website load process...', 'info');
                
                // Show loading, hide error and website
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error').style.display = 'none';
                document.getElementById('website').style.display = 'none';
                
                // Fetch content data
                debugLog('Fetching content data...', 'info');
                const contentCSV = await fetchCSVData(CONTENT_GID);
                const contentData = parseCSV(contentCSV);
                const { siteData, sections } = extractContentData(contentData);
                
                // Fetch styling data
                debugLog('Fetching styling data...', 'info');
                const stylingCSV = await fetchCSVData(STYLING_GID);
                const stylingData = parseCSV(stylingCSV);
                const styles = extractStylingData(stylingData);
                
                // Apply styling first
                applyStyling(styles);
                
                // Populate content
                populateWebsite(siteData, sections);
                
                // Hide loading, show website
                document.getElementById('loading').style.display = 'none';
                document.getElementById('website').style.display = 'block';
                
                debugLog('Website loaded successfully!', 'success');
                
            } catch (error) {
                debugLog(`Failed to load website: ${error.message}`, 'error');
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                
                // Provide helpful error message
                let errorMessage = error.message;
                if (errorMessage.includes('publish')) {
                    errorMessage = `Please publish your Google Sheet to the web:
1. Open your Google Sheet
2. Go to File > Share > Publish to web
3. Select "Entire Document" 
4. Choose "CSV" format
5. Click "Publish"
6. Copy the link and update the SHEET_ID if needed`;
                }
                
                document.getElementById('error').innerHTML = `Error: ${errorMessage}`;
            }
        }

        // Load website when page loads
        document.addEventListener('DOMContentLoaded', loadWebsite);
    </script>
</body>
</html>
